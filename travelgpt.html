<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TravelGPT | Super App Edition</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- === OPEN SOURCE LIBRARIES === -->
    <!-- Leaflet JS (Maps) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- TensorFlow.js (Object Detection) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>

    <!-- Tesseract.js (OCR) -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <style>
        /* === CORE THEME === */
        :root {
            --primary: #10b981;
            --glass-bg: rgba(15, 23, 42, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #020617; 
            color: #f8fafc;
            overflow: hidden; 
            height: 100dvh; 
            width: 100vw;
        }

        /* Animation Background */
        .grid-bg {
            position: fixed; inset: 0; z-index: 0;
            background-image: 
                linear-gradient(rgba(16, 185, 129, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(16, 185, 129, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
        }

        /* Glassmorphism */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-card:active { transform: scale(0.98); }

        /* Animations */
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        .pulse-ring::before {
            content: ''; position: absolute; inset: -10px;
            border-radius: 50%; background-color: #10b981;
            opacity: 0.4; animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        .scan-line {
            width: 100%; height: 2px; background: #10b981;
            box-shadow: 0 0 10px #10b981;
            animation: scan 2s linear infinite;
        }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

        /* Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Canvas for AR */
        #ar-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }

        /* Dropdown Styling */
        select option {
            background-color: #0f172a;
            color: #f8fafc;
            padding: 10px;
        }
        
        /* Message Bubbles */
        .msg-user { background: #10b981; color: #020617; border-radius: 12px 12px 0 12px; align-self: flex-end; }
        .msg-ai { background: rgba(255,255,255,0.1); color: #f8fafc; border-radius: 12px 12px 12px 0; align-self: flex-start; border: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body class="flex justify-center items-center bg-slate-950">

    <div class="grid-bg"></div>

    <!-- MAIN APP CONTAINER -->
    <div class="relative w-full h-full md:max-w-md md:h-[90vh] bg-slate-950 md:rounded-[2.5rem] md:border-[8px] md:border-slate-800 shadow-2xl flex flex-col z-10 overflow-hidden ring-1 ring-white/10">
        
        <!-- HEADER -->
        <header class="absolute top-0 w-full z-40 px-6 py-5 flex justify-between items-center glass md:rounded-b-3xl">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-600 flex items-center justify-center shadow-lg shadow-emerald-500/20">
                    <i class="ph-bold ph-planet text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg text-white leading-none">Travel<span class="text-emerald-400">GPT</span></h1>
                    <span class="text-[9px] font-mono text-slate-400 uppercase tracking-widest">Super App</span>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div id="connection-status" class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse" title="Online"></div>
                <div class="w-9 h-9 rounded-full bg-slate-800 border border-white/10 overflow-hidden">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" />
                </div>
            </div>
        </header>

        <!-- CONTENT AREA -->
        <main class="flex-1 relative w-full h-full">

            <!-- === 1. HOME VIEW === -->
            <section id="view-home" class="view-section absolute inset-0 pt-28 px-6 pb-24 overflow-y-auto no-scrollbar">
                
                <!-- Teleport / Change Location (Cascading Dropdowns) -->
                <div class="mb-6 space-y-3">
                    <div class="glass p-3 rounded-2xl border-white/10 relative">
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Explore India</p>
                            <!-- AUTO-LOCATE BUTTON -->
                            <button onclick="detectLiveLocation()" class="flex items-center gap-1 text-[10px] font-bold text-emerald-400 hover:text-emerald-300 transition-colors">
                                <i class="ph-bold ph-crosshair"></i> Auto-Detect
                            </button>
                        </div>
                        <div class="flex gap-2 mb-2">
                            <select id="state-select" onchange="populateDistricts()" class="w-1/2 bg-slate-800/50 text-xs font-bold text-white p-2 rounded-xl focus:outline-none appearance-none cursor-pointer border border-white/5">
                                <option value="">State</option>
                                <!-- Populated by JS -->
                            </select>
                            <select id="district-select" onchange="teleportToDistrict()" class="w-1/2 bg-slate-800/50 text-xs font-bold text-white p-2 rounded-xl focus:outline-none appearance-none cursor-pointer border border-white/5 disabled:opacity-50" disabled>
                                <option value="">District/City</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                    </div>

                    <!-- Manual Search Fallback -->
                    <div class="glass p-2 rounded-2xl flex items-center gap-2 border-white/10 focus-within:border-blue-500/50 transition-colors">
                        <div class="w-8 h-8 rounded-xl bg-slate-800 flex items-center justify-center text-blue-400">
                            <i class="ph-bold ph-magnifying-glass"></i>
                        </div>
                        <input type="text" id="teleport-query" placeholder="Or type any village/city..." class="bg-transparent border-none text-xs w-full py-2 focus:outline-none text-white placeholder-slate-500 font-bold">
                        <button onclick="teleportToCity()" id="btn-teleport" class="bg-blue-600 hover:bg-blue-500 text-white w-8 h-8 rounded-xl transition-all flex items-center justify-center">
                            <i class="ph-bold ph-paper-plane-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Weather API Widget -->
                <div class="relative w-full h-40 rounded-3xl overflow-hidden shadow-2xl mb-6 group border border-white/5">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600 to-emerald-600 opacity-90"></div>
                    <div class="absolute inset-0 p-6 flex justify-between items-center z-10">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <i class="ph-fill ph-map-pin text-white/80 text-xs"></i>
                                <span id="weather-loc" class="text-xs font-bold text-white/80 uppercase tracking-wider">Locating...</span>
                            </div>
                            <h2 id="weather-temp" class="text-5xl font-bold text-white">--Â°</h2>
                            <p id="weather-desc" class="text-sm text-white/90 font-medium mt-1">Fetching Data...</p>
                        </div>
                        <div class="text-right">
                             <i id="weather-icon" class="ph-duotone ph-cloud-sun text-5xl text-yellow-300"></i>
                             <div class="mt-2 text-[10px] text-white/60 font-mono">Real-time</div>
                        </div>
                    </div>
                </div>

                <!-- OpenStreetMap Search -->
                <div class="space-y-4">
                    <label class="text-xs text-slate-400 font-bold uppercase tracking-wider">What to find?</label>
                    
                    <!-- UPDATED Quick Categories -->
                    <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                        <button onclick="quickSearch('attractions')" class="px-4 py-2 rounded-xl bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 text-xs text-amber-400 font-bold hover:bg-amber-500 hover:text-white whitespace-nowrap transition-all flex items-center gap-2 shadow-[0_0_15px_rgba(245,158,11,0.2)]">
                            <i class="ph-fill ph-star"></i> Top 20
                        </button>
                        <button onclick="quickSearch('temple')" class="px-4 py-2 rounded-xl bg-slate-800/50 border border-white/5 text-xs text-slate-300 hover:text-emerald-400 hover:border-emerald-500/30 whitespace-nowrap transition-all flex items-center gap-2">
                            <i class="ph-fill ph-mosque"></i> Temples
                        </button>
                        <button onclick="quickSearch('park')" class="px-4 py-2 rounded-xl bg-slate-800/50 border border-white/5 text-xs text-slate-300 hover:text-emerald-400 hover:border-emerald-500/30 whitespace-nowrap transition-all flex items-center gap-2">
                            <i class="ph-fill ph-tree"></i> Parks
                        </button>
                        <button onclick="quickSearch('restaurant')" class="px-4 py-2 rounded-xl bg-slate-800/50 border border-white/5 text-xs text-slate-300 hover:text-emerald-400 hover:border-emerald-500/30 whitespace-nowrap transition-all flex items-center gap-2">
                            <i class="ph-fill ph-hamburger"></i> Food
                        </button>
                        <button onclick="quickSearch('shopping')" class="px-4 py-2 rounded-xl bg-slate-800/50 border border-white/5 text-xs text-slate-300 hover:text-emerald-400 hover:border-emerald-500/30 whitespace-nowrap transition-all flex items-center gap-2">
                            <i class="ph-fill ph-shopping-bag"></i> Shopping
                        </button>
                        <button onclick="quickSearch('hotel')" class="px-4 py-2 rounded-xl bg-slate-800/50 border border-white/5 text-xs text-slate-300 hover:text-emerald-400 hover:border-emerald-500/30 whitespace-nowrap transition-all flex items-center gap-2">
                            <i class="ph-fill ph-bed"></i> Hotels
                        </button>
                    </div>
                    
                    <!-- Hidden Query Input for Logic -->
                    <input type="hidden" id="osm-query">
                </div>

                <!-- Results List -->
                <div id="results-area" class="mt-6 space-y-4">
                    <div class="text-center py-10 opacity-40">
                        <i class="ph-duotone ph-map-trifold text-4xl mb-2"></i>
                        <p class="text-xs">Select a category to explore</p>
                    </div>
                </div>
            </section>

            <!-- === 2. MAP VIEW === -->
            <section id="view-map" class="view-section absolute inset-0 hidden">
                <div id="map" class="w-full h-full bg-slate-800 grayscale-[20%]"></div>
                <button onclick="locateUser()" class="absolute bottom-28 right-4 z-[400] w-12 h-12 bg-emerald-500 text-slate-900 rounded-2xl shadow-xl flex items-center justify-center active:scale-95 transition-transform">
                    <i class="ph-bold ph-crosshair text-xl"></i>
                </button>
            </section>

            <!-- === 3. AR / CAMERA VIEW === -->
            <section id="view-ar" class="view-section absolute inset-0 hidden bg-black">
                <video id="ar-video" autoplay playsinline muted loop class="absolute inset-0 w-full h-full object-cover opacity-80"></video>
                <img id="ar-static-img" class="absolute inset-0 w-full h-full object-contain bg-black hidden z-10 opacity-80">
                <canvas id="ar-canvas" class="relative z-10"></canvas>
                <input type="file" id="img-upload" accept="image/*" class="hidden" onchange="handleFileUpload(this)">

                <div id="camera-error" class="hidden absolute inset-0 z-[60] flex flex-col items-center justify-center bg-slate-900 p-8 text-center">
                    <div class="w-16 h-16 bg-rose-500/10 rounded-full mb-4 flex items-center justify-center"><i class="ph-duotone ph-camera-slash text-3xl text-rose-500"></i></div>
                    <h3 class="text-white font-bold text-lg">Camera Access Blocked</h3>
                    <p class="text-slate-400 text-sm mb-6">Use demo mode or enable camera.</p>
                    <button onclick="startDemoMode()" class="bg-white/10 text-white px-6 py-3 rounded-xl text-sm font-bold border border-white/10">Use Demo</button>
                </div>

                <div class="absolute top-24 left-4 right-4 z-20 flex flex-col gap-3">
                    <div class="flex gap-2">
                        <button onclick="switchVision('object')" id="btn-vis-obj" class="flex-1 bg-emerald-500 text-slate-900 py-2 rounded-lg text-xs font-bold shadow-lg">Object Detect</button>
                        <button onclick="switchVision('ocr')" id="btn-vis-ocr" class="flex-1 bg-black/50 text-white backdrop-blur py-2 rounded-lg text-xs font-bold border border-white/10">Scanner</button>
                    </div>
                    
                    <div id="ocr-controls" class="hidden flex gap-2">
                        <div class="glass p-1.5 rounded-xl flex-1 flex items-center gap-2 border-white/10">
                            <span class="text-[10px] text-slate-400 uppercase font-bold pl-1">Reading:</span>
                            <select id="ocr-source-lang" class="bg-transparent text-emerald-400 text-xs font-bold w-full focus:outline-none cursor-pointer">
                                <option value="eng">English</option>
                                <option value="hin">Hindi</option>
                                <option value="kan">Kannada</option>
                                <option value="tam">Tamil</option>
                                <option value="tel">Telugu</option>
                                <option value="mal">Malayalam</option>
                            </select>
                        </div>
                        <button onclick="triggerUpload()" class="bg-blue-600 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-lg flex items-center gap-1 active:scale-95 transition-transform">
                            <i class="ph-bold ph-image"></i> Gallery
                        </button>
                    </div>
                    
                    <div id="ocr-lang-panel" class="hidden glass p-2 rounded-xl flex items-center gap-2 border-white/10">
                        <span class="text-[10px] text-slate-400 uppercase font-bold pl-2">Translate To:</span>
                        <select id="target-lang" onchange="updateArTranslation()" class="bg-slate-800 text-white text-xs font-bold rounded-lg p-2 flex-1 focus:outline-none border border-white/10 cursor-pointer">
                            <option value="en">English</option>
                            <option value="hi">Hindi</option>
                            <option value="kn">Kannada</option>
                            <option value="ta">Tamil</option>
                            <option value="te">Telugu</option>
                            <option value="ml">Malayalam</option>
                        </select>
                    </div>
                </div>

                <div id="ocr-result" class="absolute bottom-32 left-4 right-4 bg-slate-900/90 p-4 rounded-xl border border-emerald-500/30 hidden backdrop-blur-md z-30">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-[10px] text-emerald-400 uppercase font-bold">Detected Text</p>
                        <button onclick="closeOcr()" class="text-slate-500 hover:text-white"><i class="ph-bold ph-x"></i></button>
                    </div>
                    <p id="ocr-text" class="text-xs text-slate-300 font-mono mb-2 line-clamp-2">Scanning...</p>
                    <div class="h-[1px] bg-white/10 w-full mb-2"></div>
                    <p class="text-[10px] text-blue-400 uppercase font-bold mb-1">Translation</p>
                    <p id="ocr-trans-text" class="text-sm text-white font-bold leading-relaxed">...</p>
                </div>
            </section>

            <!-- === 4. TRANSLATOR VIEW === -->
            <section id="view-translate" class="view-section absolute inset-0 hidden pt-28 px-6 pb-24 overflow-y-auto no-scrollbar">
                <div class="flex flex-col h-full gap-4">
                    <div class="glass p-3 rounded-2xl flex justify-between items-center bg-slate-900/80">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 uppercase font-bold pl-2">From</label>
                            <select id="trans-source" class="w-full bg-transparent text-emerald-400 font-bold text-sm p-2 focus:outline-none">
                                <option value="en">English</option>
                                <option value="hi">Hindi</option>
                                <option value="kn">Kannada</option>
                                <option value="ta">Tamil</op